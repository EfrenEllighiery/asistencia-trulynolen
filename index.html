<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Registro de Asistencia - Truly Nolen</title>
  <style>
    body { font-family: Arial, sans-serif; max-width: 600px; margin: auto; padding: 20px; }
    label { display: block; margin-top: 15px; }
    button { margin-top: 20px; background-color: #e2231a; color: #fff; border: none; padding: 10px 20px; cursor: pointer; }
  </style>
</head>
<body>
  <h2>Registro de Asistencia</h2>
  <form id="form">
    <label>Nombre:
      <input type="text" id="nombre" required />
    </label>
    <label>Tipo de Registro:
      <select id="tipoRegistro" required>
        <option value="">Selecciona</option>
        <option value="Entrada">Entrada</option>
        <option value="Salida">Salida</option>
      </select>
    </label>
    <div id="ubicacionInfo" style="margin-top:15px; font-style: italic; color: gray;"></div>
    <button type="submit">Enviar</button>
  </form>

  <script>
    const ubicacionInfo = document.getElementById('ubicacionInfo');
    let lat = null;
    let lng = null;

    // Obtener ubicación GPS
    if (navigator.geolocation) {
      navigator.geolocation.getCurrentPosition(
        (pos) => {
          lat = pos.coords.latitude;
          lng = pos.coords.longitude;
          ubicacionInfo.textContent = Ubicación detectada: Lat lat.toFixed(5), Lng{lng.toFixed(5)};
        },
        (err) => {
          ubicacionInfo.textContent = 'No se pudo obtener ubicación.';
        }
      );
    } else {
      ubicacionInfo.textContent = 'Tu navegador no soporta geolocalización.';
    }

    // Enviar datos al Web App de Google Apps Script
    document.getElementById('form').addEventListener('submit', e => {
      e.preventDefault();
      if(lat === null || lng === null) {
        alert('No se ha podido obtener la ubicación, por favor permite el acceso.');
        return;
      }

      const data = {
        nombre: document.getElementById('nombre').value,
        tipoRegistro: document.getElementById('tipoRegistro').value,
        latitud: lat,
        longitud: lng
      };

      fetch('https://script.google.com/macros/s/AKfycbyL-96irfnF769lGmVHtd19Va5iW0htmIX-A5RrlKd9bYP6xfdjokQuYvquQIbsUM7x/exec', {
        method: 'POST',
        body: JSON.stringify(data)
      })
      .then(res => res.json())
      .then(response => {
        if(response.result === 'success') {
          alert('Asistencia registrada correctamente.');
          document.getElementById('form').reset();
          ubicacionInfo.textContent = '';
        } else {
          alert('Error al registrar asistencia.');
        }
      })
      .catch(() => alert('Error de conexión.'));
    });
  </script>
</body>
</html>

